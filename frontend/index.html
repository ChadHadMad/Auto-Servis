<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>Autoservis ‚Äì Narud≈æbe</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        input, select, button { padding: 6px; margin: 4px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #eee; }
        button { cursor: pointer; }
    </style>
</head>
<body>

<h2>Nova narud≈æba</h2>

<input id="customer" placeholder="Ime klijenta">
<input id="vehicle" placeholder="Vozilo">
<input id="date" type="date">
<button onclick="createOrder()">Dodaj</button>

<h2>Popis narud≈æbi</h2>
<table id="orders">
    <thead>
        <tr>
            <th>ID</th>
            <th>Klijent</th>
            <th>Vozilo</th>
            <th>Datum</th>
            <th>Status</th>
            <th>Akcije</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const API = "/api";

function loadOrders() {
    fetch(`${API}/orders`)
        .then(r => r.json())
        .then(data => {
            const tbody = document.querySelector("#orders tbody");
            tbody.innerHTML = "";

            data.forEach(o => {
                tbody.innerHTML += `
                <tr>
                    <td>${o.id}</td>
                    <td>${o.customer_name}</td>
                    <td>${o.vehicle}</td>
                    <td>${o.service_date}</td>
                    <td>
                        <select onchange="updateStatus('${o.id}', this.value)">
                            ${["created","in_progress","finished","cancelled"]
                                .map(s =>
                                    `<option value="${s}" ${s === o.status ? "selected" : ""}>${s}</option>`
                                )
                                .join("")}
                        </select>
                    </td>
                    <td>
                        <button onclick="deleteOrder('${o.id}')">üóë Obri≈°i</button>
                    </td>
                </tr>`;
            });
        })
        .catch(err => alert("Gre≈°ka pri dohvaƒáanju narud≈æbi: " + err));
}

function createOrder() {
    fetch(`${API}/orders`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            customer_name: customer.value,
            vehicle: vehicle.value,
            service_date: date.value
        })
    })
    .then(() => {
        customer.value = "";
        vehicle.value = "";
        date.value = "";
        loadOrders();
    })
    .catch(err => alert("Gre≈°ka pri dodavanju narud≈æbe: " + err));
}

function updateStatus(id, status) {
    fetch(`${API}/orders/${id}/status?status=${status}`, {
        method: "PUT"
    })
    .then(loadOrders)
    .catch(err => alert("Gre≈°ka pri promjeni statusa: " + err));
}

function deleteOrder(id) {
    if (!confirm("Sigurno obrisati narud≈æbu?")) return;

    fetch(`${API}/orders/${id}`, { method: "DELETE" })
        .then(loadOrders)
        .catch(err => alert("Gre≈°ka pri brisanju: " + err));
}

loadOrders();
</script>

</body>
</html>
